Linear mixed model code for grade analyses#load necessary packageslibrary(lme4)library(lmerTest)library(emmeans)library(car)

#data need to be in long format including columns for ID, system (conventional/flexible), gender (female/male), grade level (9-12), academic quarter (1-4), and academic discipline (languages/sciences/social sciences), 
# data for models 1 and 2 are from all available students (n=157)
#data for models 3a-d are only from cohort 1 (n=63)
#data for models 4a-f are only in the flexible system (n=129)#develop model 1 (general effects)model1 <- lmer(grade_perc ~ system + gender+ grade_level + quarter + discipline +                (1 | ID) + gender:discipline,         data= data, na.action=na.omit)#run post hoc comparisons for model 1emm_options(pbkrtest.limit = 16724, lmerTest.limit = 16724)emm1 <- emmeans(model1, ~ gender:discipline)pairs(emm1, simple="each")#develop model 2 (system effects)model2 <- lmer(grade_perc ~ PrePostFilter + gender+ grade_level + quarter + discipline +               (1 | ID)+  discipline:system + gender:system,                data= data, na.action=na.omit)#run post hoc comparisons for model 2emm_options(pbkrtest.limit = 16724, lmerTest.limit = 16724)emm2.1 <-emmeans(model2 ~ gender:systempairs(emm2.1, simple="each")emm2.2 <-emmeans(Model1, ~ discipline:system)pairs(emm2.2, simple="each")#develop model 3a-d (effects of sleep changes)#model 3a: Chronotype changemodel3a <- lmer(grade_perc ~ system + gender + grade_level+ quarter + discipline +  DeltaMSFsc_centred +               (1 | ID)+               system:DeltaMSFsc_centred,              data=data_cohort1, na.action=na.omit)#model 3b: Sleep duration changemodel3b <- lmer(grade_perc ~ system + gender + grade_level+ quarter + discipline +  DeltaSleep_centred +               (1 | ID)+               system:DeltaSleep_centred,              data=data_cohort1, na.action=na.omit)#model 3c: Social jetlag changemodel3c <- lmer(grade_perc ~ system + gender + grade_level+ quarter + discipline +  DeltaSJL_centred +               (1 | ID)+               system:DeltaSJL_centred,              data=data_cohort1, na.action=na.omit)#model 3d: 9AM-usemodel3d <- lmer(grade_perc ~ system + gender + grade_level+ quarter + discipline +  frequency9AM_days +               (1 | ID)+               system: frequency9AM_days,              data=data_cohort1, na.action=na.omit)#develop model 4a-e (sleep effects in flexible system only)#model 4a: Chronotypemodel4a <-lmer(grade_perc ~ + gender+ grade_level + quarter + discipline +            MSFsc +              (1 | ID),              data=data[data$system=="flexible",], na.action=na.omit)#model 4b: Sleep durationmodel4b <-lmer(grade_perc ~ + gender+ grade_level + quarter + discipline +            SDur +               (1 | ID),               data=data[data$system=="flexible",], na.action=na.omit)#model 4c: Social jetlagmodel4c <-lmer(grade_perc ~ + gender+ grade_level + quarter + discipline +            SJL +                (1 | ID),                data=data[data$system=="flexible",], na.action=na.omit)#model 4d: 9AM-usemodel4d <-lmer(grade_perc ~ + gender+ grade_level + quarter + discipline +            frequency9AMstarts_days +                (1 | ID),                data=data[data$system=="flexible",], na.action=na.omit)#model 4e: all togethermodel4e <-lmer(grade_perc ~  gender+ grade_level + quarter + discipline +      MSFsc + SJL + SDur + frequency9AMstarts_days +                 (1 | ID),                 data=data[data$system=="flexible",], na.action=na.omit)#calculating collinearity for model4evif(model4e)